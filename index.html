<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UUID Converter</title>

  <!-- Коротко: версия и тема задаются ранне, чтобы не было мигания -->
  <script>
    (function(){
      const APP_VERSION = '1.2.1';
      window.APP_VERSION = APP_VERSION;
      try {
        const raw = localStorage.getItem('uuid_converter_prefs');
        if (raw) {
          const p = JSON.parse(raw);
          if (p && p.theme) document.documentElement.setAttribute('data-theme', p.theme);
        }
      } catch (e) {}
    })();
  </script>

  <link rel="stylesheet" href="style.css?v=1.2.1" />
  <link rel="icon" href="favicon.jpg" />
</head>
<body>
  <div id="loader" aria-hidden="true">
    <div class="dots-container" aria-hidden="true">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>

  <div class="app-shell container">
    <header class="site-header" role="banner">
      <div class="header-left">
        <h1 class="title">UUID Converter</h1>
      </div>

      <nav class="header-controls" role="navigation" aria-label="Настройки интерфейса">
        <div class="palette-control" id="paletteControl" aria-label="Палитра акцента">
          <button class="icon-btn" id="paletteToggle" aria-haspopup="true" aria-expanded="false" aria-label="Открыть палитру акцента">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3C7 3 4 6 4 11c0 5 4 8 8 8s8-3 8-8c0-5-3-8-8-8z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>

          <div class="palette-popover" id="palettePopover" role="dialog" aria-hidden="true" aria-label="Выбор цвета акцента">
            <div class="palette-presets" id="palettePresets" aria-hidden="false"></div>

            <label class="palette-custom">
              <input type="color" id="paletteColor" value="#2b7be4" aria-label="Выбрать свой цвет акцента">
              <span class="small">Свой цвет</span>
            </label>

            <div class="palette-actions">
              <button id="paletteReset" class="ghost small" type="button" aria-label="Сбросить цвет">Сбросить</button>
            </div>
          </div>
        </div>

        <button id="themeToggle" class="icon-btn" aria-pressed="false" aria-label="Переключить тему (светлая / тёмная)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M3 12h2M19 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.2" fill="none"/>
          </svg>
        </button>

        <button id="hotkeysBtn" class="icon-btn" aria-haspopup="true" aria-expanded="false" aria-controls="hotkeysModal" aria-label="Справка по горячим клавишам">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2v20M2 12h20" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </nav>
    </header>

    <main class="panel" id="mainPanel" role="main" aria-labelledby="mainTitle">
      <h2 id="mainTitle" class="visually-hidden">Главная панель конвертера</h2>

      <section class="block input-block" aria-labelledby="inputLabel">
        <label id="inputLabel" class="small field-label" for="input">Поле для ввода</label>
        <textarea id="input" name="input" placeholder="Введите строки..." aria-label="Ввод строк для конвертации" spellcheck="false" autocomplete="off"></textarea>
      </section>

      <section class="block output-block" aria-labelledby="outputLabel">
        <label id="outputLabel" class="small field-label" for="output">Результат</label>
        <textarea id="output" name="output" readonly placeholder="Здесь появится результат..." aria-label="Результат конвертации" spellcheck="false"></textarea>

        <div class="controls-row" role="region" aria-label="Панель управления">
          <div class="controls-left">
            <button id="clear" type="button" class="ghost btn-animate" aria-label="Очистить поля">
              <span class="btn-icon" aria-hidden="true">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M3 6h18" stroke="currentColor" stroke-width="1.4"/><path d="M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="currentColor" stroke-width="1.4"/></svg>
              </span>
              Очистить
            </button>
          </div>

          <div class="controls-right controls-nowrap">
            <button id="convert" type="button" class="btn-animate" data-tooltip="Ctrl/Cmd + Enter" aria-keyshortcuts="Ctrl+Enter" aria-label="Конвертировать">
              <span class="btn-icon" aria-hidden="true">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 10-9 9" stroke="currentColor" stroke-width="1.4"/><path d="M21 3v6h-6" stroke="currentColor" stroke-width="1.4"/></svg>
              </span>
              Конвертировать
            </button>

            <button id="historyBtn" type="button" class="ghost floating btn-animate" aria-label="Открыть историю" aria-controls="historyModal">
              <span class="btn-icon" aria-hidden="true">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 12a9 9 0 11-2.9-6.3" stroke="currentColor" stroke-width="1.4"/><path d="M12 7v5l3 3" stroke="currentColor" stroke-width="1.4"/></svg>
              </span>
              История
              <span class="badge" id="historyCount" aria-hidden="true">0</span>
            </button>

            <button id="copy" type="button" class="ghost btn-animate" aria-label="Копировать результат">
              <span class="btn-icon" id="copyIcon" aria-hidden="true">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M16 4h-2a2 2 0 0 0-4 0H8a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z" stroke="currentColor" stroke-width="1.4"/></svg>
              </span>
              <span class="copy-label">Копировать</span>
            </button>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer" role="contentinfo">
      <p class="footersmall">Локальная история хранится в LocalStorage.</p>
      <p class="footersmall2">Данные не отправляются на сервер — всё сохраняется в браузере.</p>
      <p id="appVersion" class="footersmall3" aria-live="polite">Версия: —</p>
    </footer>
  </div>

  <!-- toast для обновлений (вставляется JS-ом) -->
  <div id="updateToastRoot" aria-live="polite" aria-atomic="true"></div>

  <!-- HISTORY MODAL -->
  <div class="modal animated" id="historyModal" role="dialog" aria-modal="true" aria-labelledby="historyTitle" aria-hidden="true">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="historyTitle">История</h2>
        <div class="modal-actions">
          <button id="clearHistoryBtn" type="button" class="ghost" aria-label="Очистить историю">Очистить</button>
          <button class="close" id="closeHistory" aria-label="Закрыть историю">×</button>
        </div>
      </div>

      <div id="historyNotice" class="small">Если сайт тормозит — можно очистить локальную историю.</div>
      <div class="history-list" id="historyContent" aria-live="polite">Нет записей</div>
    </div>
  </div>

  <!-- HOTKEYS MODAL -->
  <div class="modal animated" id="hotkeysModal" role="dialog" aria-modal="true" aria-labelledby="hotkeysTitle" aria-hidden="true">
    <div class="modal-content" role="document">
      <div class="modal-header">
        <h2 id="hotkeysTitle">Горячие клавиши</h2>
        <div class="modal-actions">
          <button class="close" id="closeHotkeys" aria-label="Закрыть справку">×</button>
        </div>
      </div>

      <ul class="hotkeys-list">
        <li><strong>Ctrl / ⌘ + Enter</strong> — Конвертировать</li>
        <li><strong>Esc</strong> — Закрыть модальные окна</li>
      </ul>
      <div class="small muted">Поддерживаются Ctrl (Windows/Linux) и ⌘ (Mac).</div>
    </div>
  </div>

  <script src="app.js?v=1.2.1" defer></script>
</body>
</html>
